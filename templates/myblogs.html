<!-- extends base.html -->
{% extends "base.html" %}

<!--page title-->
{% block title %}Myblogs{% endblock title %}

<!--active class to show the current active page-->
{%block myblog%}active{%endblock myblog%}

<!--shows welcome msg and logout option for logged in users-->
{%block userActivity%}
    <span class="text-white me-2">Welcome, {{fullname}} |</span>
    <span class="nav-item">
        <a href="./logoutuser" class="nav-link text-white ps-1">
            <span class="fas fa-sign-out-alt"></span> Logout
        </a>
    </span>
{% endblock userActivity %}

<!--body block containing all the blogs of the logged in user-->
{%block body%}

    <div class="container mt-4">

        {% if messages %}
            {% for message in messages %}
                <div class="row justify-content-center mt-2">
                    <div class="col col-md-5 mx-2 alert alert-{{message.tags}} alert-dismissible fade show" role="alert">
                        <strong>{{ message }}</strong>
                        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                    </div>
                </div>
            {% endfor %}
        {% endif %}

        <!--Modal for confirming the deletion of the selected blog-->
        <div class="modal fade" id="blogmodal" tabindex="-1" >
            <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content">
                    <form action="./myblog" method="POST">
                        {% csrf_token %}
                        <div class="modal-header">
                            <h5 class="modal-title" id="exampleModalLabel">Warning!</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body">
                            Are you sure you want to delete this blog?
                        </div>
                        <div class="modal-footer" id="blogtodelete">
                            <button type="submit" class="btn btn-primary">Yes</button>
                            <button type="reset" class="btn btn-secondary" data-bs-dismiss="modal">No</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!--Adding a new blog-->
        <div class="row justify-content-center mb-3">
            <div class="col col-md-8">
                <label class="fs-4 text-secondary" data-bs-toggle="collapse" data-bs-target="#newBlog" style="cursor:pointer" onclick="resetBody()">
                    <span class="fas fa-plus-circle"></span> Add new blog...
                </label>
            </div>
        </div>
        <div class="row justify-content-center collapse" id="newBlog">
            <div class="col col-md-8 border rounded mx-2 p-3">
                <form action="./myblog" method="POST" id="addBlog">
                    {% csrf_token %}
                    <div class="row mb-3">
                        <label for="title" class="col-sm-2 col-form-label">Title</label>
                        <div class="col-sm-10">
                            <input type="text" class="form-control" id="title" name="title" placeholder="Title of your blog...">
                        </div>
                    </div>
                    <div class="row mb-3">
                        <label for="blogbody" class="col-sm-2 col-form-label">Body</label>
                        <div class="col-sm-10">
                            <textarea class="form-control" id="blogbody" name="blogbody" rows="10" placeholder="Type something here..." style="resize: none;"></textarea>
                        </div>
                    </div>
                    <button type="submit" class="btn btn-success col offset-md-2">Submit</button>
                    <button type="reset" class="btn btn-danger text-white ms-2" data-bs-toggle="collapse" data-bs-target="#newBlog" onclick="resetBody()">Cancel</button>
                </form>
            </div>
        </div>
        <hr>

        <!--displays blogs posted by the logged in user-->
        {% if blogs %}
            <h3 class="text-center mb-4">Your Blogs</h3>
            {% for blog in  blogs %}
                <div class="row justify-content-center mb-3">
                    <div class="col col-md-8 border rounded-2 mx-2 p-2">
                        <div class="dropdown">
                            <span class="fas fa-ellipsis-v btn float-end" data-bs-toggle="dropdown"></span>
                            <ul class="dropdown-menu" aria-labelledby="dropdownMenuButton1">
                                <li><button class="dropdown-item btn" type="submit" onclick="editBlog({{blog.id}})">Edit</button></li>
                                <li><button class="dropdown-item btn" data-bs-toggle="modal" data-bs-target="#blogmodal" onclick="deleteBlog({{blog.id}})">Delete</a></li>
                            </ul>
                        </div>
                        <div class="row">
                            <h4 id="blog{{blog.id}}title">{{blog.title}}</h4>
                            <small>by @{{blog.username}}</small>
                            <small> Date published: {{blog.timestamp}}</small>
                        </div>
                        <hr class="my-1">
                        <div class="row">
                            <div class="col mx-4">
                                <p id="blog{{blog.id}}body">{{blog.body}}</p>
                            </div>
                        </div>
                    </div>
                </div>
            {% endfor %}
        {% else %}
            <div class="text-center" style="color:#ddd">
                <span class="fas fa-folder-open fa-5x"></span>
                <h2>Nothing to show.</h2>
            </div>
        {% endif %}

    </div>
{%endblock body%}